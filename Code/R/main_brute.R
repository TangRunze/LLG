
rm(list = ls())
setwd("/Users/Runze/Documents/GitHub/LLG/Code/R")
# setwd("E:/GitHub/Experiment_SWU4")
# setwd("/cis/home/rtang/Experiment_SWU4")

# require(rARPACK)

m = 5;
nIter = 100;
dVec = 2:3;

dataName = "CPAC200"
# dataName = "desikan"
# dataName = "JHU"
# dataName = "slab907"
# dataName = "slab1068"
# dataName = "Talairach"


source("function_collection.R")
tmpList = read_data(dataName, DA=F)
A_all = tmpList[[1]]
n = tmpList[[2]]
M = tmpList[[3]]
rm(tmpList)


nD = length(dVec)

add <- function(x) Reduce("+", x)
A_sum = add(A_all)

error_P_hat = matrix(0, nD, nIter)
error_A_bar = matrix(0, nD, nIter)

# ptm <- proc.time()
# proc.time() - ptm

# sapply(dVec, function(d) replicate(nIter, dim_brute(M, m, d, A_all)))
# system.time(out <- mclapply(1:nIter, function(x) sapply(dVec, function(d) dim_brute(M,m,d,A_all))))
# system.time(out <- sapply(1:nIter, function(x) sapply(dVec, function(d) dim_brute(M,m,d,A_all))))

# for (iD in 1:nD) {
#   print(iD)
#   d = dVec[iD]
#   tmp = replicate(nIter, dim_brute(M, m, d, A_all))
# }

for (iD in 1:nD) {
  print(iD)
  d = dVec[iD]
  for (iIter in 1:nIter) {
    out = dim_brute(M, m, d, A_all)
    error_A_bar[iD, iIter] = out[1]
    error_P_hat[iD, iIter] = out[2]
  }
}

fileName = paste("../../Result/result_", dataName, "_", n, "brute_", m, ".RData", sep="")
save(error_P_hat, error_A_bar, n, M, m, dVec, file=fileName)
